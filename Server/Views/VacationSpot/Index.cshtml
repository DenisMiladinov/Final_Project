@model IEnumerable<Models.VacationSpot>
@{
    Layout = "_Layout";
    ViewData["Title"] = "Destinations";
}

@section Styles {
    <link rel="stylesheet"
          href="~/css/Views/VacationSpot/Index.css"
          asp-append-version="true" />
}

<section class="section__container destination__container">
    <div class="section__header">
        <div>
            <h2 class="section__title">Explore top destinations</h2>
            <p class="section__subtitle">
                Discover our most popular vacation spots around the world.
            </p>
        </div>
        <div class="destination__nav">
            <i class="ri-arrow-left-s-line"></i>
            <i class="ri-arrow-right-s-line"></i>
        </div>
        <form class="spot-search" method="get" asp-action="Index">
            <input type="text"
                   name="search"
                   class="spot-search__input"
                   placeholder="Type to seach"
                   value="@(ViewData["CurrentFilter"] ?? "")" />
            <button type="submit" class="spot-search__btn">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
        </form>
        <form class="spot-search" method="get" asp-action="Index">
            <select name="locationFilter"
                    class="spot-filter__select"
                    onchange="this.form.submit()">
                <option value="">All</option>
                <option value="Bulgaria"
                        selected="@( (ViewData["CurrentLocationFilter"] as string) == "Bulgaria" )">Bulgaria</option>
                <option value="Germany"
                        selected="@( (ViewData["CurrentLocationFilter"] as string) == "Germany" )">Germany</option>
                <option value="Italy"
                        selected="@( (ViewData["CurrentLocationFilter"] as string) == "Italy" )">Italy</option>
            </select>
        </form>
        <form class="spot-search ms-2" method="get" asp-action="Index">
            <select name="categoryFilter"
                    class="spot-filter__select"
                    onchange="this.form.submit()">
                <option value="">All Categories</option>
                @foreach (var item in (SelectList)ViewBag.Categories)
                {
                    <option value="@item.Value"
                            selected="@(ViewData["CurrentCategoryFilter"]?.ToString() == item.Value)">
                        @item.Text
                    </option>
                }
            </select>
        </form>
    </div>
    <div class="destination__grid">
        @foreach (var spot in Model)
        {
            <div class="vacation-card">
                <img src="@(Url.Content($"~/assets/Spots/{spot.Images.First().ImageUrl.Split('/').Last()}"))" 
                alt="@spot.Title" />
                <h3>@spot.Title</h3>
                <p>@spot.Location</p>
                <p class="vacation-card__category">
                    Category: @spot.Category?.Name
                </p>
                <div class="vacation-card__footer">
                    <p class="vacation-card__price">@spot.PricePerNight lv</p>
                    <a asp-controller="VacationSpot"
                       asp-action="Details"
                       asp-route-id="@spot.SpotId"
                       class="btn--deal">
                        Check deal →<i class="ri-arrow-right-s-line"></i>
                    </a>
                </div>

            </div>
         }
    </div>
</section>

@section Scripts {
    <script>
        document.querySelector('.spot-search__input').addEventListener('input', function() {
            const q = this.value.toLowerCase();
            document.querySelectorAll('.vacation-card').forEach(card => {
                const txt = (
                    card.querySelector('h3').textContent +
                    card.querySelector('p').textContent
                ).toLowerCase();
                card.style.display = txt.includes(q) ? '' : 'none';
            });
        });
    </script>
}